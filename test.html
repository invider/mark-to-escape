<html>
    <head><title>Test</title></head>
    <script src="jam/scene.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        html, body {
            background-color: #444444;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
    <body>
        <script>

        this['@lab/main'] = {
            info: 'main dot entity',
            dt: 0,
            dx: 0,
            dy: 0,

            init: function() {
                this._.log.out('dot entity init - attached to scene')
            },

            spawn: function() {
                this._.log.out('dot entity is spawned - included to the lab')
            },

            evo: function(scene, delta) {
                // init x,y if needed
                if (!this.x) {
                    this.x = scene.env.width/2
                    this.y = scene.env.height/2
                }

                if (this.dt <= 0) {
                    // new time and direction
                    this.dt = 1 + Math.random() * 3
                    this.dx = (50 + Math.random() * 40) * (Math.random() - 0.5)
                    this.dy = (50 + Math.random() * 40) * (Math.random() - 0.5)
                }

                // move point and delta time
                this.x += this.dx * delta
                this.y += this.dy * delta
                this.dt -= delta

                // check boundaries
                if (this.x < 0 || this.x >scene.env.width || this.y < 0 || this.y > scene.env.height) {
                    this.x = scene.env.width/2
                    this.y = scene.env.height/2
                }
            },

            draw: function(ctx) {
                // clear the screen
                ctx.fillStyle = "#220044"
                ctx.fillRect(0, 0, canvas.width, canvas.height)
                // draw dot
                ctx.fillStyle="#FF0000";
                ctx.fillRect(this.x, this.y, 3, 3); 
            }
        }

        // some env data
        this['@env/score'] = 100
        this['@env/stat/hits'] = 101

        // push object to dir
        this['@env/stat/'] = { name: 'OK', val: '102' }

        // augment existing object
        this['additional@env/stat/OK'] = { nom: 'notOK', val2: '105' }

        // inject values to pre-existing array
        this['_1@env/data/'] = 1
        this['_2@env/data/'] = 2
        this['_3@env/data/'] = 3

        // patch additional stat values
        this._patch$$stat_value = {
            _patchAt: 'env/stat/OK/',
            next: 4,
            last: 5,
        }

        // patch OK again
        this._patch$$stat_value = {
            _$patchAt: 'env/stat',
            OK: { val3: 'whaaat?' },
            Obj2: { val: 'some' },
            'Obj2/more': { val: 'another' },
        }

        // some library item
        this['message@lib/msg'] = 'library message'
            
        </script>
    </body>
</html>
